<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>XX电台 - One Last Kiss</title>
    
    <!-- 1. 引入 Tailwind CSS (样式库) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 引入 React 和 Babel (核心引擎) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* 额外的动画样式 */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>

    <script type="text/babel">
        // 简化版的图标组件 (SVG)
        const Icons = {
            Play: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
            Pause: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
            Heart: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>,
            Share2: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>,
            Music: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
        };

        const { useState, useEffect, useRef } = React;

        const MusicCard = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentTime, setCurrentTime] = useState(0);
            const canvasRef = useRef(null);
            const animationRef = useRef(null);

            // 你的推歌数据
            const songData = {
                title: "One Last Kiss",
                artist: "宇多田光 (Hikaru Utada)",
                date: "2025.12.07 | XX电台 Vol.257",
                message: "既然不知道写点什么，那就把表达权交给旋律吧。这首歌有一种神奇的魔力，它听起来轻快，底色却是深情的告别。",
                quote: "Can you give me one last kiss?",
                theme: { primary: "#e60012", secondary: "#ffffff" }
            };

            // Canvas 绘图逻辑
            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                // 适配不同屏幕的清晰度
                const updateSize = () => {
                    const dpr = window.devicePixelRatio || 1;
                    // 获取父容器的大小
                    const parent = canvas.parentElement;
                    const rect = parent.getBoundingClientRect();
                    
                    canvas.width = rect.width * dpr;
                    canvas.height = rect.height * dpr;
                    ctx.scale(dpr, dpr);
                    return { w: rect.width, h: rect.height };
                };

                let { w, h } = updateSize();
                
                // 监听窗口大小改变 (手机旋转等)
                window.addEventListener('resize', () => { ({ w, h } = updateSize()) });

                let rotation = 0;

                const render = () => {
                    const cx = w / 2;
                    const cy = h / 2;
                    const radius = Math.min(w, h) * 0.35; 

                    ctx.clearRect(0, 0, w, h);

                    // 1. 动态声波背景
                    if (isPlaying) {
                        const bars = 40;
                        for (let i = 0; i < bars; i++) {
                            const angle = (i / bars) * Math.PI * 2;
                            // 让波浪随机跳动
                            const barHeight = 10 + Math.sin(Date.now() / 100 + i) * 10 + Math.random() * 20;
                            const x1 = cx + Math.cos(angle) * (radius + 5);
                            const y1 = cy + Math.sin(angle) * (radius + 5);
                            const x2 = cx + Math.cos(angle) * (radius + 5 + barHeight);
                            const y2 = cy + Math.sin(angle) * (radius + 5 + barHeight);
                            
                            ctx.beginPath();
                            ctx.moveTo(x1, y1);
                            ctx.lineTo(x2, y2);
                            ctx.strokeStyle = `rgba(230, 0, 18, ${0.2 + Math.random() * 0.3})`;
                            ctx.lineWidth = 3;
                            ctx.stroke();
                        }
                    }

                    // 2. 绘制唱片
                    ctx.save();
                    ctx.translate(cx, cy);
                    if (isPlaying) rotation += 0.02;
                    ctx.rotate(rotation);

                    // 唱片本体
                    ctx.beginPath();
                    ctx.arc(0, 0, radius, 0, Math.PI * 2);
                    ctx.fillStyle = '#111';
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = 'rgba(0,0,0,0.6)';
                    ctx.fill();
                    ctx.shadowBlur = 0;

                    // 唱片纹理
                    ctx.strokeStyle = '#222';
                    ctx.lineWidth = 1;
                    for (let r = radius * 0.35; r < radius - 2; r += 5) {
                        ctx.beginPath();
                        ctx.arc(0, 0, r, 0, Math.PI * 2);
                        ctx.stroke();
                    }

                    // 封面 Label
                    ctx.beginPath();
                    ctx.arc(0, 0, radius * 0.35, 0, Math.PI * 2);
                    ctx.fillStyle = songData.theme.secondary;
                    ctx.fill();

                    // 封面红点
                    ctx.beginPath();
                    ctx.arc(0, 0, radius * 0.15, 0, Math.PI * 2);
                    ctx.fillStyle = songData.theme.primary;
                    ctx.fill();

                    ctx.restore();
                    animationRef.current = requestAnimationFrame(render);
                };

                render();
                return () => cancelAnimationFrame(animationRef.current);
            }, [isPlaying]);

            // 模拟进度条
            useEffect(() => {
                let interval;
                if (isPlaying) {
                    interval = setInterval(() => setCurrentTime(t => t + 1), 1000);
                }
                return () => clearInterval(interval);
            }, [isPlaying]);

            const formatTime = (s) => `${Math.floor(s / 60)}:${Math.floor(s % 60).toString().padStart(2, '0')}`;

            return (
                <div className="min-h-screen w-full flex items-center justify-center p-4 bg-gray-900 font-sans">
                    <div className="w-full max-w-md bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl overflow-hidden shadow-2xl flex flex-col relative">
                        
                        {/* 顶部 */}
                        <div className="flex justify-between items-center p-6 border-b border-white/5">
                            <div className="flex items-center space-x-2">
                                <span className={`w-2 h-2 bg-red-500 rounded-full ${isPlaying ? 'animate-pulse' : ''}`}></span>
                                <span className="text-xs font-bold tracking-widest text-gray-400 uppercase">ON AIR</span>
                            </div>
                            <div className="text-xs font-mono text-gray-500">{songData.date}</div>
                        </div>

                        {/* 中间 Canvas */}
                        <div className="relative w-full aspect-square bg-gradient-to-b from-gray-800 to-black">
                            <canvas ref={canvasRef} className="w-full h-full block" />
                            
                            {!isPlaying && (
                                <button 
                                    onClick={() => setIsPlaying(true)}
                                    className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-16 h-16 bg-white/10 backdrop-blur-md rounded-full flex items-center justify-center border border-white/20 hover:scale-110 transition-transform cursor-pointer z-10"
                                >
                                    <Icons.Play className="w-6 h-6 text-white ml-1" />
                                </button>
                            )}
                        </div>

                        {/* 底部信息 */}
                        <div className="p-6 space-y-4">
                            <div className="flex justify-between items-end">
                                <div>
                                    <h1 className="text-2xl font-bold text-white mb-1">{songData.title}</h1>
                                    <p className="text-red-400 font-medium">{songData.artist}</p>
                                </div>
                                <Icons.Heart className="w-6 h-6 text-gray-500 hover:text-red-500 cursor-pointer transition-colors" />
                            </div>

                            <div className="space-y-1">
                                <div className="h-1 bg-gray-700 rounded-full overflow-hidden">
                                    <div className="h-full bg-red-500 transition-all duration-1000 ease-linear" style={{ width: `${(currentTime % 252) / 252 * 100}%` }}></div>
                                </div>
                                <div className="flex justify-between text-xs text-gray-500 font-mono">
                                    <span>{formatTime(currentTime)}</span>
                                    <span>4:12</span>
                                </div>
                            </div>

                            <div className="bg-white/5 rounded-xl p-4 border border-white/5 mt-4">
                                <p className="text-sm text-gray-300 leading-relaxed mb-3">{songData.message}</p>
                                <p className="text-xs font-serif italic text-gray-500 text-right">— {songData.quote}</p>
                            </div>
                            
                            <div className="flex items-center justify-between pt-2">
                                <button className="p-2 hover:bg-white/10 rounded-full text-gray-400"><Icons.Share2 className="w-5 h-5" /></button>
                                <button onClick={() => setIsPlaying(!isPlaying)} className="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center shadow-lg hover:bg-red-700 text-white transition-transform active:scale-95">
                                    {isPlaying ? <Icons.Pause className="w-5 h-5" /> : <Icons.Play className="w-5 h-5 ml-1" />}
                                </button>
                                <button className="p-2 hover:bg-white/10 rounded-full text-gray-400"><Icons.Music className="w-5 h-5" /></button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MusicCard />);
    </script>
</body>
</html>